@model IEnumerable<IranSoftjo.Package.WebUi.ViewModels.TblItemVm>
@{
    ViewBag.Title = "جستجو مختصات جبهه بر روی نقشه";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}
@*<script src="~/Scripts/jquery-1.10.2.js"></script>
    <script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>*@
<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyC4QY3t06BnpiMl-0rgHG9-Pe8MdLlq5W0&sensor=false"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var gmarkers = [];
        var map;
        function initialize() {

            var mapProp = {
                center: new google.maps.LatLng(35.7, 51.4), //India Lat and Lon
                zoom: 11,
                mapTypeId: google.maps.MapTypeId.ROADMAP,

                zoomControl: true,
                zoomControlOptions: {
                    style: google.maps.ZoomControlStyle.DEFAULT,
                },
                disableDoubleClickZoom: true,
                mapTypeControl: true,
                scaleControl: true,
                scrollwheel: true,
                streetViewControl: true,
                draggable: true,
                overviewMapControl: true,
                overviewMapControlOptions: {
                    opened: true,
                },
            };
            map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
        }
        google.maps.event.addDomListener(window, 'load', initialize);

        var x = $("#txtSearch").val();
        $.ajax({
            type: "POST",
            url: '@Url.Action("Search", "RasTblItems")', //"../Map/Search"
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ "location": x }),
            dataType: "json",
            success: function (data) {
                var table = "<table class='table'>";
                $.each(data, function (index, value) {
                    table += "<tr><td>" + value.ItemCode + "</td></tr>";
                    var latlng = new google.maps.LatLng(value.Latitude, value.Longitude);
                    var marker = new google.maps.Marker({
                        position: latlng,
                        icon: "/Package/Raspod/Photo/pinkball.png",
                        map: map
                    });

                    var infowindow = new google.maps.InfoWindow({
                        content: "<div class='infoDiv'>" +
                          " <hr/>" + "  کد  :  " + "<h2>" + value.ItemCode + "</h2>" + "" +
                        " <hr/> عنوان :  " + "<h3>" + value.Title + "</h3>" +
                             " <hr/> آدرس :  " + value.Address + "</div>"
                    });
                    google.maps.event.addListener(marker, 'click', function () {
                        infowindow.open(map, marker);
                    });

                    gmarkers.push(marker);

                });
                table += "</table>";
                $("#myData").html(table);

            }
        });
        $("#txtSearch").keyup(function () {
            var x = $("#txtSearch").val();

            for (i = 0; i < gmarkers.length; i++) {
                gmarkers[i].setMap(null);
            }

            $.ajax({
                type: "POST",
                url: '@Url.Action("Search", "RasTblItems")', //"../Map/Search"
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ "location": x }),
                dataType: "json",
                success: function (data) {
                    var table = "<table class='table'>";
                    $.each(data, function (index, value) {
                        table += "<tr><td>" + value.ItemCode + "</td></tr>";
                        var latlng = new google.maps.LatLng(value.Latitude, value.Longitude);
                        var marker = new google.maps.Marker({
                            position: latlng,
                            icon: "/Package/Raspod/Photo/pinkball.png",
                            map: map
                        });
                        var infowindow = new google.maps.InfoWindow({
                            content: "<div class='infoDiv'>" +
                          " <hr/>" + "  کد  :  " + "<h2>" + value.ItemCode + "</h2>" + "" +
                            " <hr/> عنوان :  " + "<h3>" + value.Title + "</h3>" +
                            " <hr/> توضیحات :  " + "<h3>" + value.Comment + "</h3>" +
                                 " <hr/> آدرس :  " + value.Address + "</div>"
                        });
                        google.maps.event.addListener(marker, 'click', function () {
                            infowindow.open(map, marker);
                        });

                        gmarkers.push(marker);

                    });
                    table += "</table>";
                    $("#myData").html(table);

                }
            });
        });
    });
</script>

<table>
    <tr>
        <td valign="top">
            @Html.TextBox("txtSearch", null, new { @placeholder = "جستجو بر اساس کد " })
            <div id="myData">
                <table class="table">
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>
                                @item.ItemCode
                            </td>
                        </tr>
                    }
                </table>
            </div>
        </td>
        <td valign="top">
            <div id="googleMap" style="width:1100px;height:600px;"></div>
        </td>
    </tr>
</table>

